# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Типы данных, используемые в приложении

Интерфейс API 
```
interface IRequest<T> {
  method: string;
  url: string;
  data?: T;
}

interface IResponse<T> {
  status: number;
  data: T | null;
}

interface IApi {
  request<T>(request: IRequest<T>): Promise<IResponse<T>>;
}
```
Карточка товара
```
interface ICardData {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number|null;
}
```
Заказ и общая сумма к оплате
```
interface IOrder {
  items: TBasketItem[];
  totalPrice: number;
}
```

Функции, использующиеся при работе с корзиной покупок
```
interface IBasketOperations {
  addToBasket(item: TBasketItem): void;
  calculateTotalPrice(): number;
  deleteItem(id: string): void;
  clearOrder(): void;
}
```
Форма оформления заказа: шаг 1, выбор оплаты и адреса
```
interface IPaymentForm {
  payment: string;
  address: string;

  selectPaymentMethod(method: 'online' | 'onDelivery'): void;
  enterAddress(inputAddress: HTMLInputElement): void;
}
```
Форма оформления заказа: шаг 2, контакты покупателя
```
interface IContactsForm {
  email: string;
  phone: number;
  
  enterEmail(inputEmail: HTMLInputElement): void;
  enterPhone(inputPhone: HTMLInputElement): void;
}
```
Данные для `POST`-запроса, принимаемые сервером
```
interface IOrderData {
  total: number;
  items: string[];
  payment: string;
  address: string;
  email: string;
  phone: number;
}
```
Итоговая сумма покупки
```
type TTotalPrice = Pick<IOrder, 'totalPrice'>;
```
Данные товара, находящегося в корзине
```
type TBasketItem = Pick<ICardData, 'id' | 'title' | 'price'>;
```

## Архитектура приложения

Код приложения разделён на слои согласно MVC: 
- **Модель**: хранение и изменение данных
- **Отображение**: визуализация данных на странице, 
- **Контроллер**: связь отображения и данных.

### Слой модели

#### Класс CardApi
Класс отвечает за получение данных о товарах с сервера. При удачном ответе возвращает массив карточек. При сбое уведомляет об ошибке на сервере.

#### Класс ClientApi
Класс отвечает за отправку данных о покупке на сервер. Отправляемые данные:
- `id` купленных товаров и их общая стоимость
- способ оплаты и адрес доставки
- контактные данные покупателя (email и номер телефона)

#### Класс CardData
Класс отвечает за хранение данных о товаре, полученных с помощью `CardApi`.

#### Класс Basket
Хранит данные о товарах, находящихся в корзине. Содержит в себе следующие методы для работы:
- `addToBasket(item: TBasketItem)`: добавляет в массив корзины товар, переданный как аргумент.
- `calculateTotalPrice()`: подсчитывает общую сумму заказа и записывает её в свойство `totalPrice` класса `Basket`.
- `deleteItem(id: string)`: удаляет товар, найденный по `id` из массива товаров корзины и осуществляет пересчёт общей стоимости исходя из обновлённых данных.
- `clearOrder()`: очищает корзину после успешного оформления заказа.

#### Класс Payment
Отвечает за сбор и хранение данных об оплате и адресе доставки. Реализуется при помощи данных методов:
- `selectPaymentMethod(method: 'online' | 'onDelivery')`: осуществляется выбор способа оплаты на основе предложенных (_онлайн / при получении_).
- `enterAddress(inputAddress: HTMLInputElement)`: записывает в свойство `address` значение поля ввода, переданного аргументом.

#### Класс Contacts
Собирает и хранит контактные данные пользователя. Содержит методы:
- `enterEmail(inputEmail: string)`: записывает в свойство `email` значение поля ввода, переданного аргументом.
- `enterPhone(inputPhone: number)`: в свойство `phone` записывается числовое значение поля ввода, переданного аргументом

#### Класс OrderData
Собирает данные о покупке, необходимые для отправки на сервер. Для этого экземпляр `OrderData` передаётся аргументом в классы,где используя сеттеры получает необходимую информацию (`BasketPopup`, `PaymentPopup` и `ContactsPopup`).

### Слой отображения

#### Класс CardTemplate
Используется как шаблон для отображения карточек товаров на странице и в модальном окне. Содержит в себе метод `createCard(templateId: string)`, аргументом которого передаётся `id (#)` template-элемента. Метод отрисовывает карточку, используя данные, хранящиеся в `CardData`, и присваивает каждой категории товара стилизующий класс.

#### Класс Popup
Данный класс также используется как шаблон всех модальных окон на странице. В конструктор класса аргументом передаётся селектор модального окна, существующего в DOM-дереве, в который впоследствии будет помещён template-элемент модального окна.

Класс имеет базовые методы, осуществляющие работу модального окна:
- `openModal()`: открывает модальное окно.
- `closeModal()`: закрывает модальное окно.
- `closeBySpaceAround(evt: MouseEvent)`: вспомогательный метод для закрытия модального окна, осуществляется по клику `evt` вне его пространства.

#### Класс Card
Реализуется, используя шаблон отображения `CardTemplate`. Метод `getCard()` возвращает карточку товара для лальнейшего взаимодействия с ней.

#### Класс CardPopup
Реализуется, используя шаблоны отображения `CardTemplate` и `Popup`. Предоставляет покупателю более развёрнутую информацию о товаре.

Методы отображения: 
- `openModal()`: открывает модальное окно товара.
- `closeModal()`: закрывает модальное окно товара.
- `updateStateItem(button: HTMLButtonElement)`: уведомляет пользователя о состоянии товара (добавлен ли он в корзину). Об этом сигнализирует кнопка, переданная аргументом метода. Если товар уже есть в корзине, текст на кнопке изменится с **"Купить"** на **"Убрать"**.

#### Класс BasketIcon
Класс уведомляет пользователя о количестве товаров в корзине. Имеет в себе метод `updateCounter()`, который отображает количество элементов в массиве `items` класса `Basket`.

#### Класс BasketPopup
Реализуется, используя шаблон отображения `Popup`. Предоставляет пользователю информацию о наличествующих товарах в корзине.

Методы отображения:
- `openModal()`: открывает модальное окно корзины.
- `closeModal()`: закрывает модальное окно корзины.
- `updateOrderButtonState()`: блокирует кнопку оформления, если корзина пуста. В обратной ситуации делает кнопку активной.
- `clearBasketList()`: вспомогательный метод для обновления отображения данных в модальном окне, очищает корзину для появления актуальной информации.
- `updateItemIndexes()`: метод, реализующий нумерацию товаров в корзине.
- `updateTotalPrice()`: отображает текущую сумму заказа.
- `addItemToBasketPopup()`: отображает информацию о добавленном товаре (название и стоимость). Содержит в себе возможность удаления товара из корзины при помощи метода `removeItemFromBasketPopup(itemId: string)`
- `updateBasketPopup()`: актуализирует отображение товаров в корзине, используя выше перечисленные методы.

#### Класс SuccessfulOrder
Реализуется, используя шаблон отображения `Popup`. Класс отвечает за уведомление клиента об успешном оформлении заказа. При открытии модального окна отображается сумма `totalPrice` из класса `Basket`, списанная со счёта. Методы класса:
- `openModal()`: открывает модальное окно успешного оформления заказа.
- `closeModal()`: закрывает модальное окно успешного оформления заказа, очищая корзину и обнуляя счётчик товаров на главной странице.
- `printTotalPrice()`: отображает итоговую сумму покупки.

### Слой Контроллер

#### Класс CardPopup
Помимо отображения класс также отчасти играет роль контроллера. За эту часть отвечает метод `toggleStateButton(button: HTMLButtonElement)`, который меняет состояние кнопки в зависимости от наличия `id` данного товара в свойстве `items` класса `Basket` - добавляет товар в корзину, если его там ещё нет, и убирает из неё, если он там уже есть.

#### Класс BasketPopup
Данный класс отображения содержит в себе метод, относящийся к слою Контроллер - `removeItemFromBasketPopup(itemId: string)`, который позволяет удалить товар из массива `items` класса `Basket`, используя полученный как аргумент `id` товара. При удалении осуществляется обновление отображения.

#### Класс FormValidation
Осуществляет валидацию полей ввода, исключив тем самым недостаток необходимой информации для оформления заказа. Содержит в себе следующие методы:
- `showErrorMessage()`: вспомогательный метод. Отображает сообщение об ошибке.
- `hideErrorMessage()`: вспомогательный метод. Скрывает сообщение об ошибке.
- `disableButton()`: вспомогательный метод. Отключает кнопку оформления заказа.
- `enableButton()`: вспомогательный метод. Включает кнопку для оформления заказа.
- `isFormValid()`: вспомогательный метод. Проверяет все поля формы на валидность и возвращает булево значение.
- `checkInputValidity(input: HTMLInputElement)`: основной метод, осуществляющий валидацию полей, принимающий аргументом поле ввода, чъё значение подвергается проверке. Возвращает булево значение, на основе которого можно судить об успешности валидации. Если форма валидна, кнопка оформления становится доступной.

#### Класс PaymentPopup
Реализуется, используя шаблон отображения `Popup`. Класс используется при открытии модального окна оплаты. Здесь покупатель выбирает способ оплаты и адрес доставки. За отображение отвечают методы `openModal()` и `closeModal()`.

Методы контроллера:
- `selectPaymentMethod(button: HTMLButtonElement, method: 'online' | 'onDelivery')`: шаблонный метод выбора способа доставки. Аргументами передаются кнопка, на которую осуществляется нажатие, и способ оплаты (метод), который она описывает. При выборе кнопки результат записывается в свойство `payment` класса `Payment`.
- `сhandleOnlineClick()`: реализация шаблона `selectPaymentMethod` для кнопки `Онлайн`.
- `handleOnDeliveryClick()`: реализация шаблона `selectPaymentMethod` для кнопки `При получении`.
- `isActive()`: вспомогательный метод, проверяющий наличие активного класса на кнопке способа оплаты.
- `checkFormValidity()`: общая валидация формы, расширяет действие `FormValidation` для проверки кнопок способа оплаты.
- `clearForm()`: метод, осуществляющий очистку формы для ввода новых данных при оформлении следующего заказа.

#### Класс ContactsPopup
Реализуется, используя шаблон отображения `Popup`. Класс используется при открытии модального окна ввода контактных данных пользователя. За отображение отвечают методы `openModal()` и `closeModal()`. Валидация полей осуществляется с использованием класса `FormValidation`. Метод `clearForm()` очищает форму для ввода новых данных при оформлении следующего заказа. 